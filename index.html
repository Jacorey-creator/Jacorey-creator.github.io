<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rowe Bytes</title>
  <link rel="stylesheet" href="Models\home_styling.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Verify Three.js is loaded
    window.addEventListener('load', function() {
      if (typeof THREE === 'undefined') {
        console.error('Three.js failed to load');
        // Try loading Three.js again
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js';
        script.onload = function() {
          console.log('Three.js loaded successfully on retry');
          initCube();
        };
        script.onerror = function() {
          console.error('Failed to load Three.js on retry');
        };
        document.head.appendChild(script);
      } else {
        console.log('Three.js loaded successfully');
      }
    });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    :root {
      --hunter-green: #355E3B;
      --hunter-green-light: #4A7A4F;
      --hunter-green-dark: #2A4B2F;
      --black: #0A0A0A;
      --white: #FFFFFF;
      --gray-light: #F5F5F5;
      --gray: #E0E0E0;
      --gray-dark: #333333;
      --rubiks-red: #8B4513;
      --rubiks-orange: #D2691E;
      --rubiks-yellow: #DAA520;
      --rubiks-green: #556B2F;
      --rubiks-blue: #4682B4;
      --rubiks-white: #F5F5DC;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, var(--black) 0%, var(--hunter-green-dark) 100%);
      color: var(--white);
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    header {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--glass-border);
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
      padding: 1rem 2rem;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }

    nav h1 {
      color: var(--white);
      margin: 0;
      font-size: 2rem;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 2.5rem;
    }

    .nav-links a {
      color: var(--white);
      text-decoration: none;
      font-weight: 500;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: var(--hunter-green-light);
      transition: width 0.3s ease;
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    #hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 6rem 2rem;
      background: linear-gradient(135deg, rgba(53, 94, 59, 0.2) 0%, rgba(10, 10, 10, 0.8) 100%);
    }

    #hero h2 {
      font-size: 4rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: linear-gradient(to right, var(--white), var(--hunter-green-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: fadeInUp 1s ease;
    }

    #hero p {
      font-size: 1.5rem;
      color: var(--gray);
      max-width: 600px;
      margin: 0 auto;
      animation: fadeInUp 1s ease 0.2s;
      animation-fill-mode: both;
    }

    section {
      padding: 6rem 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    section h2 {
      color: var(--white);
      font-size: 3rem;
      margin-bottom: 3rem;
      text-align: center;
      position: relative;
      padding-bottom: 1rem;
    }

    section h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: var(--hunter-green);
      border-radius: 2px;
    }

    .project-card {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--glass-shadow);
      color: var(--white);
      transition: all 0.4s ease;
    }

    .project-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }

    .project-card h3 {
      color: var(--white);
      margin-bottom: 1rem;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .project-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      margin: 1.5rem 0;
    }

    .project-image {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 12px;
      border: 2px solid var(--glass-border);
      transition: all 0.3s ease;
    }

    .project-image:hover {
      transform: scale(1.02);
      border-color: var(--hunter-green-light);
    }

    .project-link {
      display: inline-block;
      background: var(--hunter-green);
      color: var(--white);
      padding: 1rem 2rem;
      border-radius: 8px;
      text-decoration: none;
      margin: 1rem 0;
      transition: all 0.3s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .project-link:hover {
      background: var(--hunter-green-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .project-files {
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
    }

    .project-files ul {
      list-style: none;
      padding: 0;
    }

    .project-files li {
      margin: 0.8rem 0;
    }

    .project-files a {
      color: var(--hunter-green-light);
      text-decoration: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .project-files a:hover {
      color: var(--white);
    }

    #cube-container {
      width: 500px;
      height: 500px;
      position: relative;
      perspective: 1000px;
      transition: all 0.5s ease;
      margin: 0 auto;
      flex-shrink: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid var(--glass-border);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--glass-shadow);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    #cube-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      border-radius: 16px;
      overflow: hidden;
    }

    .cube-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 1rem;
      z-index: 100;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
    }

    .cube-control-btn {
      background: var(--hunter-green);
      color: var(--white);
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      letter-spacing: 0.5px;
      min-width: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cube-control-btn:hover {
      background: var(--hunter-green-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    #projects-container {
      display: flex;
      gap: 3rem;
      align-items: center;
      justify-content: center;
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      width: 100%;
      flex-wrap: wrap;
      position: relative;
      min-height: 600px;
    }

    #additional-projects {
      width: 45%;
      transition: all 0.5s ease;
      flex-shrink: 0;
      margin-left: 550px;
      position: relative;
      z-index: 2;
    }

    footer {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-top: 1px solid var(--glass-border);
      color: var(--white);
      text-align: center;
      padding: 2rem;
      margin-top: 4rem;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      #cube-container {
        width: 400px;
        height: 400px;
      }
    }

    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        gap: 1rem;
      }

      .nav-links {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }

      #hero h2 {
        font-size: 2.5rem;
      }

      #hero p {
        font-size: 1.2rem;
      }

      section {
        padding: 4rem 1rem;
      }

      .project-gallery {
        grid-template-columns: 1fr;
      }

      #cube-container {
        width: 300px;
        height: 300px;
      }

      .cube-controls {
        bottom: 10px;
        padding: 0.5rem;
        gap: 0.5rem;
      }

      .cube-control-btn {
        padding: 0.75rem 1.5rem;
        min-width: 50px;
      }
    }

    .project-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 2rem;
      overflow-y: auto;
    }

    .project-detail-view {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 2rem;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.3s ease;
      margin: 2rem;
    }

    .project-detail-view.active {
      transform: translateY(0);
      opacity: 1;
    }

    .image-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      z-index: 2000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .modal-content {
      max-width: 90%;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 30px;
      color: var(--white);
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
      z-index: 2001;
      transition: all 0.3s ease;
    }

    .close-modal:hover {
      color: var(--hunter-green-light);
      transform: scale(1.1);
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 50px;
      background: var(--hunter-green);
      transition: all 0.3s ease;
    }

    .toggle-btn.active {
      background: var(--hunter-green-light);
    }

    .toggle-icon {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .toggle-btn.active .toggle-icon {
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <h1>Rowe Bytes</h1>
      <ul class="nav-links">
        <li><a href="#about">About</a></li>
        <li><a href="#projects">Projects</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="login.html">DevOnly</a></li>
      </ul>
    </nav>
  </header>

  <section id="hero">
    <h2>Hello, I'm Jacorey</h2>
    <p>I'm a Software Developer who loves building things with code.</p>
  </section>

  <section id="about">
    <h2>About Me</h2>
    <p>Of course I am a pretty big nerd when it comes to computers however it's not just that! I love playing videogames, 
        ever since I was little platformers such as Donkey Kong Returns and Kirby Returns to Dreamland have always held a special place in my heart. 
        Also I really like writing and making stories; one of my favorite pass times is getting a group of friends together to play Dungeons & Dragons-
        of which I write the plot and story for the rest of the players to enjoy. My happy place has always been the beach and I hope to one day live in a home near the shore with my family</p>
  </section>

  <section id="projects">
    <h2>Projects</h2>
    <div id="projects-container">
      <div id="cube-container">
        <canvas id="cube-canvas"></canvas>
        <div class="cube-controls">
          <button class="cube-control-btn" onclick="rotateCube('left')">‚Üê</button>
          <button class="cube-control-btn" onclick="rotateCube('right')">‚Üí</button>
          <button class="cube-control-btn" onclick="rotateCube('up')">‚Üë</button>
          <button class="cube-control-btn" onclick="rotateCube('down')">‚Üì</button>
          <button class="cube-control-btn toggle-btn" id="floatToggle" onclick="toggleFloating()">
            <span class="toggle-icon">üåä</span>
          </button>
        </div>
      </div>
      <div id="additional-projects"></div>
    </div>
    <div class="project-overlay" id="projectOverlay"></div>
  </section>

  <section id="contact">
    <h2>Contact</h2>
    <p>Email me at <a href="mailto:Jacorey_Rowe2004@outlook.com">Jacorey_Rowe2004@outlook.com</a></p>
  </section>

  <footer>
    <p>&copy; 2025 Jacorey Rowe. All rights reserved.</p>
  </footer>

  <script>
    // Function to get the correct image URL
    function getImageUrl(path) {
        // If the path is already a full URL, return it
        if (path.startsWith('http')) {
            return path;
        }
        // If the path already includes 'images/', return it as is
        if (path.startsWith('images/')) {
            return path;
        }
        // Otherwise, add the images/ prefix
        return 'images/' + path.replace(/^.*[\\/]/, '');
    }

    // Function to get the API URL based on environment
    function getApiUrl() {
        // For now, return null to indicate no API is available
        return null;
    }

    // Three.js Cube Implementation
    let scene, camera, renderer, cube;
    let currentRotation = { x: 0, y: 0 };
    let isAnimating = false;
    let projects = [];
    let currentProjectIndex = -1; // Track the currently displayed project
    let isFloatingEnabled = true;

    function toggleFloating() {
      isFloatingEnabled = !isFloatingEnabled;
      const toggleBtn = document.getElementById('floatToggle');
      toggleBtn.classList.toggle('active');
      
      if (!isFloatingEnabled) {
        // Reset cube position when disabling floating
        cube.position.set(0, 0, 0);
      }
    }

    function initCube() {
      try {
        // Check if Three.js is loaded
        if (typeof THREE === 'undefined') {
          console.error('Three.js not loaded');
          return;
        }

        scene = new THREE.Scene();
        const container = document.getElementById('cube-container');
        
        if (!container) {
          console.error('Cube container not found');
          return;
        }

        const width = container.offsetWidth;
        const height = container.offsetHeight;
        
        camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ 
          canvas: document.getElementById('cube-canvas'), 
          antialias: true,
          alpha: true
        });
        renderer.setSize(width, height);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setClearColor(0x000000, 0);
        
        // Create cube geometry with 3x3x3 segments
        const geometry = new THREE.BoxGeometry(2, 2, 2, 3, 3, 3);
        
        // Create materials for each face
        const materials = [];
        for (let i = 0; i < 6; i++) {
          materials.push(new THREE.MeshPhongMaterial({ 
            color: 0xffffff,
            transparent: true,
            opacity: 0.9,
            side: THREE.DoubleSide,
            shininess: 30,
            specular: 0x444444
          }));
        }
        
        cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);
        
        // Position camera to show cube properly
        camera.position.z = 4;
        
        // Center the cube in the scene
        cube.position.set(0, 0, 0);
        
        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        // Add directional light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);
        
        // Add point light for better 3D effect
        const pointLight = new THREE.PointLight(0xffffff, 0.5);
        pointLight.position.set(-2, 2, 2);
        scene.add(pointLight);
        
        // Add click event listener to canvas
        const canvas = document.getElementById('cube-canvas');
        if (canvas) {
          canvas.addEventListener('click', onCubeClick);
          canvas.addEventListener('mousemove', onCubeHover);
        }
        
        // Initial render to ensure cube is visible
        renderer.render(scene, camera);
        
        // Start animation loop
        animate();
        
        console.log('Cube initialized successfully');
      } catch (error) {
        console.error('Error initializing cube:', error);
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    function onCubeClick(event) {
      const rect = event.target.getBoundingClientRect();
      const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
      
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2(x, y);
      
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObject(cube);
      
      if (intersects.length > 0) {
        // Get the face index (0-5)
        const faceIndex = intersects[0].face.materialIndex;
        
        // If clicking the same face that's already open, do nothing
        if (faceIndex === currentProjectIndex) {
          return;
        }
        
        // If a different project is already open, close it first
        if (currentProjectIndex !== -1) {
          closeProjectDetail();
        }
        
        if (projects[faceIndex]) {
          currentProjectIndex = faceIndex;
          showProjectDetail(projects[faceIndex]);
        }
      }
    }

    function onCubeHover(event) {
      const rect = event.target.getBoundingClientRect();
      const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
      const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
      
      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2(x, y);
      
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObject(cube);
      
      const canvas = document.getElementById('cube-canvas');
      
      if (intersects.length > 0) {
        // Get the face index (0-5)
        const faceIndex = intersects[0].face.materialIndex;
        if (projects[faceIndex]) {
          canvas.style.cursor = 'pointer';
          // Add subtle highlight effect to the face
          const material = cube.material[faceIndex];
          material.opacity = 1;
          material.needsUpdate = true;
        }
      } else {
        canvas.style.cursor = 'grab';
        // Reset all face opacities
        cube.material.forEach(material => {
          material.opacity = 0.9;
          material.needsUpdate = true;
        });
      }
    }

    function showProjectDetail(project) {
      const overlay = document.getElementById('projectOverlay');
      const detailView = document.createElement('div');
      const projectsContainer = document.getElementById('projects-container');
      const cubeContainer = document.getElementById('cube-container');
      const additionalProjects = document.getElementById('additional-projects');
      
      detailView.className = 'project-detail-view active';
      detailView.innerHTML = `
        <button class="close-btn" onclick="closeProjectDetail()">&times;</button>
        <h3>${project.name}</h3>
        ${project.images.length > 0 ? `
          <div class="project-gallery">
            ${project.images.map(image => `
              <img src="${getImageUrl(image)}" alt="${project.name}" class="project-image">
            `).join('')}
          </div>
        ` : ''}
        <p>${project.description}</p>
        ${project.webLink ? `
          <a href="${project.webLink}" target="_blank" class="project-link">View Project</a>
        ` : ''}
        ${project.files.length > 0 ? `
          <div class="project-files">
            <h4>Files:</h4>
            <ul>
              ${project.files.map(file => `
                <li><a href="${getImageUrl(file)}" target="_blank">${file.split('/').pop()}</a></li>
              `).join('')}
            </ul>
          </div>
        ` : ''}
      `;
      
      overlay.appendChild(detailView);
      overlay.style.display = 'flex';
      
      // Trigger the transition effect
      setTimeout(() => {
        detailView.classList.add('active');
      }, 50);
      
      // Adjust container widths and positions
      projectsContainer.style.justifyContent = 'flex-start';
      cubeContainer.style.width = '40%';
      cubeContainer.style.left = '20%';
      cubeContainer.style.transform = 'translateX(-50%)';
      additionalProjects.style.width = '55%';
      additionalProjects.style.marginLeft = '0';
    }

    function closeProjectDetail() {
      const overlay = document.getElementById('projectOverlay');
      const detailView = overlay.querySelector('.project-detail-view');
      const projectsContainer = document.getElementById('projects-container');
      const cubeContainer = document.getElementById('cube-container');
      const additionalProjects = document.getElementById('additional-projects');
      
      if (detailView) {
        detailView.classList.remove('active');
        setTimeout(() => {
          overlay.innerHTML = '';
          overlay.style.display = 'none';
          
          // Restore original container layout
          projectsContainer.style.justifyContent = 'center';
          cubeContainer.style.width = '500px';
          cubeContainer.style.left = '50%';
          cubeContainer.style.transform = 'translateX(-50%)';
          additionalProjects.style.width = '45%';
          additionalProjects.style.marginLeft = '550px';
          
          // Force a reflow to ensure the transition works
          void cubeContainer.offsetWidth;
          
          // Reset current project index
          currentProjectIndex = -1;
        }, 500);
      }
    }

    function updateCubeFaces() {
      projects.forEach((project, index) => {
        if (index < 6) { // Only update the first 6 projects for the cube faces
          const material = cube.material[index];
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = 512;
          canvas.height = 512;
          
          // Create a modern gradient background
          const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
          gradient.addColorStop(0, '#1a1a1a');
          gradient.addColorStop(1, '#2d2d2d');
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          // Add subtle pattern overlay
          ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
          for (let i = 0; i < canvas.width; i += 20) {
            for (let j = 0; j < canvas.height; j += 20) {
              if ((i + j) % 40 === 0) {
                ctx.fillRect(i, j, 10, 10);
              }
            }
          }
          
          // Draw decorative border
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
          ctx.lineWidth = 4;
          ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
          
          // Add inner border with gradient
          const borderGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
          borderGradient.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
          borderGradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.2)');
          borderGradient.addColorStop(1, 'rgba(255, 255, 255, 0.1)');
          ctx.strokeStyle = borderGradient;
          ctx.lineWidth = 2;
          ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

          // Load and draw project image if available
          if (project.images && project.images.length > 0) {
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.onload = function() {
              // Calculate image dimensions to maintain aspect ratio
              const imgWidth = canvas.width - 80;
              const imgHeight = 200;
              const scale = Math.min(imgWidth / img.width, imgHeight / img.height);
              const scaledWidth = img.width * scale;
              const scaledHeight = img.height * scale;
              
              // Draw image with rounded corners
              const x = (canvas.width - scaledWidth) / 2;
              const y = 40;
              const radius = 10;
              
              ctx.save();
              ctx.beginPath();
              ctx.moveTo(x + radius, y);
              ctx.lineTo(x + scaledWidth - radius, y);
              ctx.quadraticCurveTo(x + scaledWidth, y, x + scaledWidth, y + radius);
              ctx.lineTo(x + scaledWidth, y + scaledHeight - radius);
              ctx.quadraticCurveTo(x + scaledWidth, y + scaledHeight, x + scaledWidth - radius, y + scaledHeight);
              ctx.lineTo(x + radius, y + scaledHeight);
              ctx.quadraticCurveTo(x, y + scaledHeight, x, y + scaledHeight - radius);
              ctx.lineTo(x, y + radius);
              ctx.quadraticCurveTo(x, y, x + radius, y);
              ctx.closePath();
              ctx.clip();
              
              // Draw the image
              ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
              
              // Add a subtle overlay gradient
              const overlayGradient = ctx.createLinearGradient(0, y, 0, y + scaledHeight);
              overlayGradient.addColorStop(0, 'rgba(0, 0, 0, 0.2)');
              overlayGradient.addColorStop(1, 'rgba(0, 0, 0, 0.4)');
              ctx.fillStyle = overlayGradient;
              ctx.fillRect(x, y, scaledWidth, scaledHeight);
              
              ctx.restore();
              
              // Draw project title below the image
              ctx.font = 'bold 28px Arial';
              ctx.fillStyle = '#ffffff';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              
              const title = project.name.length > 20 ? project.name.substring(0, 20) + '...' : project.name;
              ctx.fillText(title, canvas.width / 2, y + scaledHeight + 30);
              
              // Draw description
              ctx.font = '18px Arial';
              ctx.fillStyle = '#cccccc';
              const description = project.description.substring(0, 100) + '...';
              const descLines = wrapText(ctx, description, canvas.width - 80, 18);
              descLines.forEach((line, i) => {
                ctx.fillText(line, canvas.width / 2, y + scaledHeight + 60 + (i * 25));
              });
              
              // Draw "Click to view" text
              ctx.font = 'bold 20px Arial';
              ctx.fillStyle = '#80cbc4';
              ctx.fillText('Click to view', canvas.width / 2, canvas.height - 30);
              
              // Create texture from canvas
              const texture = new THREE.CanvasTexture(canvas);
              material.map = texture;
              material.needsUpdate = true;
            };
            
            img.onerror = function() {
              // If image fails to load, draw a placeholder
              const x = 40;
              const y = 40;
              const width = canvas.width - 80;
              const height = 200;
              
              // Draw placeholder background
              ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
              ctx.fillRect(x, y, width, height);
              
              // Draw placeholder text
              ctx.font = '24px Arial';
              ctx.fillStyle = '#ffffff';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              ctx.fillText('Image not available', canvas.width / 2, y + height / 2);
              
              // Continue with the rest of the face content
              drawFaceContent(ctx, project, y + height + 20);
            };
            
            img.src = getImageUrl(project.images[0]);
          } else {
            // If no images available, draw the content without an image
            drawFaceContent(ctx, project, 40);
          }
        }
      });
    }

    function drawFaceContent(ctx, project, startY) {
      const canvas = ctx.canvas;
      
      // Draw project title
      ctx.font = 'bold 36px Arial';
      ctx.fillStyle = '#ffffff';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      const title = project.name.length > 20 ? project.name.substring(0, 20) + '...' : project.name;
      const titleLines = wrapText(ctx, title, canvas.width - 80, 36);
      titleLines.forEach((line, i) => {
        ctx.fillText(line, canvas.width / 2, startY + 30 + (i * 40));
      });
      
      // Draw description
      ctx.font = '20px Arial';
      ctx.fillStyle = '#cccccc';
      const description = project.description.substring(0, 150) + '...';
      const descLines = wrapText(ctx, description, canvas.width - 80, 20);
      descLines.forEach((line, i) => {
        ctx.fillText(line, canvas.width / 2, startY + 120 + (i * 25));
      });
      
      // Draw "Click to view" text
      ctx.font = 'bold 24px Arial';
      ctx.fillStyle = '#80cbc4';
      ctx.fillText('Click to view', canvas.width / 2, canvas.height - 30);
    }

    // Helper function to wrap text
    function wrapText(ctx, text, maxWidth, fontSize) {
      const words = text.split(' ');
      const lines = [];
      let currentLine = words[0];

      for (let i = 1; i < words.length; i++) {
        const word = words[i];
        const width = ctx.measureText(currentLine + ' ' + word).width;
        if (width < maxWidth) {
          currentLine += ' ' + word;
        } else {
          lines.push(currentLine);
          currentLine = word;
        }
      }
      lines.push(currentLine);
      return lines;
    }

    function rotateCube(direction) {
      if (isAnimating) return;
      isAnimating = true;
      
      const duration = 1000; // 1 second
      const startTime = Date.now();
      const startRotation = { ...currentRotation };
      
      let targetRotation = { ...startRotation };
      switch(direction) {
        case 'left':
          targetRotation.y -= Math.PI / 2;
          break;
        case 'right':
          targetRotation.y += Math.PI / 2;
          break;
        case 'up':
          targetRotation.x -= Math.PI / 2;
          break;
        case 'down':
          targetRotation.x += Math.PI / 2;
          break;
      }
      
      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Ease in-out function
        const easeProgress = progress < 0.5 ? 2 * progress * progress : 1 - Math.pow(-2 * progress + 2, 2) / 2;
        
        currentRotation.x = startRotation.x + (targetRotation.x - startRotation.x) * easeProgress;
        currentRotation.y = startRotation.y + (targetRotation.y - startRotation.y) * easeProgress;
        
        cube.rotation.x = currentRotation.x;
        cube.rotation.y = currentRotation.y;
        
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          isAnimating = false;
        }
      }
      
      animate();
    }

    // Modify the loadProjects function to handle additional projects
    async function loadProjects() {
      try {
        // Initialize cube first
        if (!scene) {
          initCube();
        }

        // Try to fetch projects, but don't let failure stop cube initialization
        try {
          const response = await fetch(getApiUrl());
          projects = await response.json();
        } catch (error) {
          console.warn('Could not fetch projects from API:', error);
          // Create some default projects for the cube faces
          projects = [
            {
              name: "Project 1",
              description: "A sample project",
              images: []
            },
            {
              name: "Project 2",
              description: "Another sample project",
              images: []
            },
            {
              name: "Project 3",
              description: "Yet another sample project",
              images: []
            },
            {
              name: "Project 4",
              description: "A fourth sample project",
              images: []
            },
            {
              name: "Project 5",
              description: "A fifth sample project",
              images: []
            },
            {
              name: "Project 6",
              description: "A sixth sample project",
              images: []
            }
          ];
        }
        
        // Update cube faces after projects are loaded
        if (scene) {
          updateCubeFaces();
        }
        
        // Display additional projects
        const additionalProjects = projects.slice(6);
        const additionalProjectsContainer = document.getElementById('additional-projects');
        
        if (additionalProjects.length > 0) {
          additionalProjectsContainer.innerHTML = `
            <h3>More Projects</h3>
            ${additionalProjects.map(project => `
              <div class="project-card" onclick="expandProject(${JSON.stringify(project).replace(/"/g, '&quot;')})">
                <h3>${project.name}</h3>
                <p>${project.description.substring(0, 100)}...</p>
                ${project.images.length > 0 ? `
                  <div class="project-gallery">
                    <img src="${getImageUrl(project.images[0])}" alt="${project.name}" class="project-image">
                  </div>
                ` : ''}
              </div>
            `).join('')}
          `;
        } else {
          additionalProjectsContainer.innerHTML = '';
        }
      } catch (error) {
        console.error('Error in loadProjects:', error);
        // Even if everything fails, try to show a basic cube
        if (!scene) {
          initCube();
        }
      }
    }

    function expandProject(project) {
      const overlay = document.getElementById('projectOverlay');
      const expandedCard = document.createElement('div');
      expandedCard.className = 'project-card expanded';
      expandedCard.innerHTML = `
        <button class="close-expanded" onclick="closeExpandedProject()">&times;</button>
        <h3>${project.name}</h3>
        ${project.images.length > 0 ? `
          <div class="project-gallery">
            ${project.images.map(image => `
              <img src="${getImageUrl(image)}" alt="${project.name}" class="project-image">
            `).join('')}
          </div>
        ` : ''}
        <p>${project.description}</p>
        ${project.webLink ? `
          <a href="${project.webLink}" target="_blank" class="project-link">View Project</a>
        ` : ''}
        ${project.files.length > 0 ? `
          <div class="project-files">
            <h4>Files:</h4>
            <ul>
              ${project.files.map(file => `
                <li><a href="${getImageUrl(file)}" target="_blank">${file.split('/').pop()}</a></li>
              `).join('')}
            </ul>
          </div>
        ` : ''}
      `;
      
      overlay.appendChild(expandedCard);
      overlay.style.display = 'block';
      
      // Shrink cube container
      document.getElementById('cube-container').style.width = '40%';
      document.getElementById('additional-projects').style.width = '55%';
    }

    function closeExpandedProject() {
      const overlay = document.getElementById('projectOverlay');
      overlay.innerHTML = '';
      overlay.style.display = 'none';
      
      // Restore original sizes
      document.getElementById('cube-container').style.width = '50%';
      document.getElementById('additional-projects').style.width = '45%';
    }

    // Load projects when the page loads
    document.addEventListener('DOMContentLoaded', loadProjects);

    // Modal functionality
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('project-image')) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImg');
            modalImg.src = e.target.src;
            modal.style.display = 'flex';
        }
        if (e.target.id === 'imageModal' || e.target.id === 'closeModal' || e.target === document.getElementById('modalImg')) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            }
        }
    });
  </script>
  <!-- Image Modal -->
  <div id="imageModal" class="image-modal" style="display:none;">
    <span id="closeModal" class="close-modal">&times;</span>
    <img class="modal-content" id="modalImg" alt="Large Project Image">
  </div>
</body>
</html>
